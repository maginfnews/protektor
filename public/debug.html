<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Teste de Formul√°rio</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #16A085; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #1B4332; }
        .status { margin-top: 20px; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin-top: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Formul√°rio - Debug</h1>
    
    <form id="testForm">
        <div class="form-group">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" value="Jo√£o Silva" required>
        </div>
        
        <div class="form-group">
            <label for="empresa">Empresa:</label>
            <input type="text" id="empresa" name="empresa" value="Fazenda Teste LTDA" required>
        </div>
        
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" value="joao@fazendateste.com.br" required>
        </div>
        
        <div class="form-group">
            <label for="telefone">Telefone:</label>
            <input type="tel" id="telefone" name="telefone" value="(11) 99999-9999" required>
        </div>
        
        <div class="form-group">
            <label for="maquina">M√°quina:</label>
            <select id="maquina" name="maquina" required>
                <option value="trator" selected>Trator</option>
                <option value="colheitadeira">Colheitadeira</option>
                <option value="outro">Outro</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="quantidade">Quantidade:</label>
            <input type="number" id="quantidade" name="quantidade" value="2" min="1" required>
        </div>
        
        <div class="form-group">
            <label for="localizacao">Localiza√ß√£o:</label>
            <input type="text" id="localizacao" name="localizacao" value="Ribeir√£o Preto / SP" required>
        </div>
        
        <button type="submit" id="submitBtn">üöÄ Testar Envio</button>
    </form>
    
    <div id="status"></div>
    <div id="logs" class="log"></div>

    <script>
        const form = document.getElementById('testForm');
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');
        
        function log(message) {
            console.log(message);
            logsDiv.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
        }
        
        function showStatus(message, type = 'success') {
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }
        
        // Envio via Web3Forms
        async function sendWithWeb3Forms(formData) {
            log('üìß Tentando Web3Forms...');
            
            const response = await fetch('https://api.web3forms.com/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    access_key: 'c9e5f1a2-8b3d-4e6f-9c8a-1b2c3d4e5f6g',
                    name: formData.get('nome'),
                    email: formData.get('email'),
                    company: formData.get('empresa'),
                    phone: formData.get('telefone'),
                    machine: formData.get('maquina'),
                    quantity: formData.get('quantidade'),
                    location: formData.get('localizacao'),
                    subject: `üöú Teste MPSH Protektor - ${formData.get('empresa')}`,
                    message: `Teste de formul√°rio:

Nome: ${formData.get('nome')}
Empresa: ${formData.get('empresa')}
Email: ${formData.get('email')}
Telefone: ${formData.get('telefone')}
M√°quina: ${formData.get('maquina')}
Quantidade: ${formData.get('quantidade')}
Localiza√ß√£o: ${formData.get('localizacao')}

Data: ${new Date().toLocaleString('pt-BR')}`
                })
            });
            
            log(`Status: ${response.status}`);
            
            if (!response.ok) {
                const errorText = await response.text();
                log(`Erro: ${errorText}`);
                throw new Error(`Web3Forms error: ${response.status}`);
            }
            
            const result = await response.json();
            log(`Resposta: ${JSON.stringify(result)}`);
            return result;
        }
        
        // Fallback mailto
        function sendWithMailto(formData) {
            log('üìß Usando mailto...');
            
            const subject = encodeURIComponent(`üöú Teste MPSH Protektor - ${formData.get('empresa')}`);
            const body = encodeURIComponent(`Teste de formul√°rio:

Nome: ${formData.get('nome')}
Empresa: ${formData.get('empresa')}
Email: ${formData.get('email')}
Telefone: ${formData.get('telefone')}
M√°quina: ${formData.get('maquina')}
Quantidade: ${formData.get('quantidade')}
Localiza√ß√£o: ${formData.get('localizacao')}

Data: ${new Date().toLocaleString('pt-BR')}`);
            
            const mailtoLink = `mailto:site@maginf.com.br?subject=${subject}&body=${body}`;
            window.open(mailtoLink, '_blank');
            
            return Promise.resolve({ success: true, method: 'mailto' });
        }
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            
            submitBtn.textContent = '‚è≥ Enviando...';
            submitBtn.disabled = true;
            
            logsDiv.textContent = '';
            log('üöÄ Iniciando teste de envio...');
            
            try {
                const formData = new FormData(form);
                
                try {
                    await sendWithWeb3Forms(formData);
                    log('‚úÖ Web3Forms: Sucesso!');
                    showStatus('‚úÖ Formul√°rio enviado com sucesso via Web3Forms!', 'success');
                } catch (web3Error) {
                    log(`‚ö†Ô∏è Web3Forms falhou: ${web3Error.message}`);
                    
                    log('üìß Tentando fallback mailto...');
                    await sendWithMailto(formData);
                    log('‚úÖ Mailto: Aberto!');
                    showStatus('‚úÖ Cliente de email aberto! Verifique se o email foi criado.', 'success');
                }
                
            } catch (error) {
                log(`‚ùå Erro geral: ${error.message}`);
                showStatus(`‚ùå Erro: ${error.message}`, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });
        
        log('üß™ P√°gina de debug carregada');
        log('üìã Preencha o formul√°rio e clique em "Testar Envio"');
    </script>
</body>
</html>
